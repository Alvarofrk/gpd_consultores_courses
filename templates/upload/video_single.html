{% extends 'base.html' %}
{% load i18n %}
{% block title %}{{ video.title }} | {% trans 'Sistema de gestión de aprendizaje' %}{% endblock title %}
{% load static %}

{% block content %}

<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">{% trans 'Inicio' %}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'programs' %}">{% trans 'Programas' %}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'program_detail' video.course.program.id %}">{{ video.course.program }}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'course_detail' video.course.slug %}">{{ video.course }}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ video.title }}</li>
    </ol>
</nav>
    
<p class="title-1">{{ video.title }}</p>
<br><br>

<div class="col-md-10 mx-auto d-block">
    <div class="video-container mb-4 rounded overflow-hidden shadow-sm">
        {% if video.vimeo_url and video.get_vimeo_id %}
            <div class="ratio ratio-16x9">
                <iframe src="https://player.vimeo.com/video/{{ video.get_vimeo_id }}" 
                        frameborder="0" 
                        allow="autoplay; fullscreen; picture-in-picture" 
                        allowfullscreen></iframe>
            </div>
        {% elif video.youtube_url and video.get_youtube_id %}
            <div class="ratio ratio-16x9 position-relative">
                <iframe id="youtube-iframe-{{ video.id }}" 
                        src="{{ video.get_youtube_embed_url }}" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                        allowfullscreen
                        loading="lazy"
                        referrerpolicy="strict-origin-when-cross-origin"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe>
                <div id="youtube-fallback-{{ video.id }}" class="d-none position-absolute w-100 h-100 d-flex align-items-center justify-content-center" style="background: rgba(0,0,0,0.8); z-index: 10;">
                    <div class="text-center text-white p-4">
                        <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                        <p class="mb-2">{% trans 'Error al cargar el video. El video puede tener restricciones de privacidad.' %}</p>
                        <a href="{{ video.youtube_url }}" target="_blank" class="btn btn-primary">
                            <i class="fas fa-external-link-alt me-2"></i>{% trans 'Ver video en YouTube' %}
                        </a>
                    </div>
                </div>
            </div>
        {% elif video.video %}
            <div class="ratio ratio-16x9">
                <video controls class="w-100" preload="metadata" playsinline>
                    <source src="{{ video.video.url }}" type="{{ video.get_video_mime_type }}">
                    <source src="{{ video.video.url }}">
                    {% trans "Tu navegador no soporta el elemento de video." %}
                </video>
            </div>
        {% else %}
            <div class="alert alert-warning">
                {% trans 'No hay video disponible para mostrar.' %}
                {% if video.vimeo_url or video.youtube_url %}
                    <br><small>{% trans 'La URL del video no es válida o no se pudo extraer el ID.' %}</small>
                {% endif %}
            </div>
        {% endif %}
    </div>
    <p><i class="fas fa-calendar"></i> {{ video.timestamp|timesince }} {% trans 'hace' %}</p>
    {% if video.summary %}
    <p class="text-orange text-center">{{ video.summary }}</p>
    {% else %}
    <p>{% trans 'No se ha establecido una descripción para el video.' %}</p>
    {% endif %}
</div>

{% endblock content %}
